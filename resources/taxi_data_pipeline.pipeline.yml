# NYC Taxi Data Pipeline (Serverless DLT - Medallion Architecture)
# Orchestration and transformations are separated:
# - pipelines/main_pipeline.py: DLT orchestration only
# - src/taxi_dlt_pkg/: Pure transformation functions (no DLT decorators)

resources:
  pipelines:
    taxi_data_pipeline:
      name: orchestrated_dlt_pipeline
      catalog: ${var.catalog}
      schema: ${var.schema}
      serverless: true
      channel: CURRENT

      libraries:
        # 1) Pipeline source file (orchestration)
        - file:
            path: ../pipelines/main_pipeline.py
        # 2) Wheel built from ./src and installed into pipeline env
        # Using artifact reference - the artifact is automatically uploaded during deployment
        # Alternative: Use direct workspace path if artifact reference doesn't work
        - whl: ${workspace.file_path}/.bundle/orchestrated_dlt_pipeline/dev/artifacts/taxi_dlt_pkg-0.1.0-py3-none-any.whl

      configuration:
        bundle.sourcePath: ${workspace.file_path}

